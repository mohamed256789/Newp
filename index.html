<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Fridge Expiry Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* --- General Fixes & Setup --- */
    * { box-sizing: border-box; }
    :root {
      --bg-primary: #0d1b2a; --bg-secondary: #1b263b; --bg-tertiary: #415a77;
      --text-primary: #fff; --text-secondary: #aaa; --accent-color: gold;
      --accent-text: #0d1b2a; --border-color: #444; --shadow-color: rgba(0,0,0,0.2);
    }
    body.light-mode {
      --bg-primary: #f4f4f9; --bg-secondary: #e9ecef; --bg-tertiary: #ffffff;
      --text-primary: #212529; --text-secondary: #6c757d; --border-color: #ccc;
      --shadow-color: rgba(0,0,0,0.1);
    }

    /* --- Animations --- */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes item-add { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes logo-shake { /* NEW ANIMATION FOR LOGO */
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-2deg); }
      75% { transform: rotate(2deg); }
    }

    /* --- Base Styles --- */
    body {
      margin: 0; padding: 0; font-family: 'Segoe UI', 'Cairo', sans-serif;
      background-color: var(--bg-primary); color: var(--text-primary);
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      text-align: center; padding: 15px; background-color: var(--bg-secondary);
      box-shadow: 0 2px 4px var(--shadow-color); position: sticky; top: 0; z-index: 100;
    }
    .app-title { /* NEW STYLE FOR LOGO AND TITLE */
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    #app-logo {
      font-size: 2em;
      animation: logo-shake 3s ease-in-out infinite;
    }
    header h1 {
      color: var(--accent-color); margin: 0; font-size: 1.5em;
    }
    .container { padding: 15px; }
    
    /* --- Forms & Controls --- */
    form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .form-row { display: flex; gap: 10px; }
    input, button, select {
      padding: 12px; border: 1px solid var(--border-color); border-radius: 8px;
      font-size: 1em; background-color: var(--bg-tertiary); color: var(--text-primary);
    }
    .form-row input, .form-row select { flex: 1; }
    #add-item-btn { width: 100%; }
    button {
      background-color: var(--accent-color); color: var(--accent-text);
      font-weight: bold; cursor: pointer; border: none; transition: filter 0.2s;
    }
    button:hover { filter: brightness(0.9); }
    .controls {
      margin-bottom: 20px; padding: 15px; background-color: var(--bg-secondary);
      border-radius: 8px; display: flex; flex-direction: column; gap: 15px;
    }
    .top-controls, .bottom-controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .top-controls { justify-content: space-between; }
    .bottom-controls { justify-content: center; }
    #search-bar { width: 100%; margin-top: 5px; }

    /* --- Item & Category List --- */
    .category-container { margin-bottom: 20px; }
    .category-header { /* NEW STYLE FOR CATEGORY TITLE */
      display: flex; align-items: center; padding: 5px; margin-bottom: 10px;
      border-bottom: 2px solid var(--accent-color);
    }
    .category-icon { font-size: 1.5em; margin-inline-end: 10px; }
    .category-title { font-size: 1.2em; font-weight: bold; color: var(--accent-color); }
    .item {
      display: flex; justify-content: space-between; align-items: center;
      background-color: var(--bg-secondary); border-inline-start: 8px solid;
      padding: 15px; border-radius: 8px; margin-bottom: 10px;
      box-shadow: 0 2px 4px var(--shadow-color); animation: item-add 0.4s ease-out;
    }
    .green { border-color: #2ecc71; } .orange { border-color: #f39c12; } .red { border-color: #e74c3c; }
    .item button {
      background-color: #e74c3c; color: #fff; border: none;
      padding: 6px 14px; border-radius: 6px; font-weight: normal;
    }
    #no-items-message {
      text-align: center; padding: 40px 20px; color: var(--text-secondary);
      font-size: 1.2em; display: none; animation: fadeIn 0.5s;
    }
    #no-items-message .icon { font-size: 3em; display: block; margin-bottom: 10px; }
    
    /* --- Modal Styles (Unchanged) --- */
    .modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);align-items:center;justify-content:center;padding:15px}.modal-box{background-color:var(--bg-secondary);padding:25px;border-radius:10px;width:100%;max-width:400px;box-shadow:0 5px 15px var(--shadow-color);text-align:center;animation:fadeIn .3s}.modal-box h3{margin-top:0;color:var(--accent-color)}.modal-box p{margin:15px 0}.modal-box textarea{width:100%;min-height:100px;margin-top:15px;background-color:var(--bg-primary);color:var(--text-primary);border:1px solid var(--border-color);border-radius:4px;font-family:monospace;padding:10px}.modal-buttons{margin-top:20px;display:flex;gap:10px;justify-content:center}.modal-buttons button{padding:10px 20px}.modal-buttons .btn-secondary{background-color:var(--bg-tertiary);color:var(--text-primary)}
  </style>
</head>
<body>

  <header>
    <div class="app-title">
      <!-- NEW ANIMATED LOGO -->
      <div id="app-logo">üßä</div>
      <h1 data-lang-key="appName">ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ´ŸÑÿßÿ¨ÿ©</h1>
    </div>
  </header>

  <div class="container">
    <form id="itemForm">
      <div class="form-row">
        <input type="text" id="name" data-lang-placeholder-key="itemNamePlaceholder" required>
        <input type="date" id="expiry" required>
      </div>
      <div class="form-row">
        <!-- NEW CATEGORY SELECTOR -->
        <select id="category">
            <option value="general" data-lang-key="catGeneral">ÿπÿßŸÖ</option>
            <option value="vegetables" data-lang-key="catVegetables">ÿÆÿ∂ÿ±Ÿàÿßÿ™</option>
            <option value="fruits" data-lang-key="catFruits">ŸÅŸàÿßŸÉŸá</option>
            <option value="dairy" data-lang-key="catDairy">ÿ£ŸÑÿ®ÿßŸÜ</option>
            <option value="meats" data-lang-key="catMeats">ŸÑÿ≠ŸàŸÖ</option>
            <option value="drinks" data-lang-key="catDrinks">ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™</option>
        </select>
        <button type="submit" id="add-item-btn" data-lang-key="addBtn">ÿ•ÿ∂ÿßŸÅÿ©</button>
      </div>
    </form>

    <div class="controls">
      <div class="top-controls">
          <div class="counter" id="countDisplay"></div>
          <div>
            <select id="language-switcher"></select>
            <button id="themeToggle">‚òÄÔ∏è/üåô</button>
          </div>
      </div>
      <input type="text" id="search-bar" data-lang-placeholder-key="searchPlaceholder">
      <div class="bottom-controls">
        <button onclick="exportData()" data-lang-key="exportBtn">ÿ™ÿµÿØŸäÿ±</button>
        <button onclick="importData()" data-lang-key="importBtn">ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ</button>
        <button onclick="confirmClearAll()" data-lang-key="clearAllBtn">ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ</button>
      </div>
    </div>

    <div id="itemList"></div>
    <div id="no-items-message">
        <span class="icon">üéâ</span>
        <span data-lang-key="noItems">ŸÇÿßÿ¶ŸÖÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ©!</span>
    </div>
  </div>

  <audio id="alertSound" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3" preload="auto"></audio>
  <div class="modal-overlay" id="custom-modal"> <div class="modal-box"> <h3 id="modal-title"></h3> <p id="modal-text"></p> <div id="modal-input-area"></div> <div class="modal-buttons"> <button id="modal-confirm-btn"></button> <button id="modal-cancel-btn" class="btn-secondary"></button> </div> </div> </div>

  <script>
    // --- DOM Elements ---
    const form = document.getElementById('itemForm');
    const itemList = document.getElementById('itemList');
    const searchBar = document.getElementById('search-bar');
    const countDisplay = document.getElementById('countDisplay');
    const noItemsMessage = document.getElementById('no-items-message');
    const languageSwitcher = document.getElementById('language-switcher');
    
    // --- State & Data ---
    let items = JSON.parse(localStorage.getItem('fridgeItems')) || [];
    const translations = {
        'en': {
            appName: 'Fridge Tracker', itemNamePlaceholder: 'Item name', addBtn: 'Add',
            exportBtn: 'Export', importBtn: 'Import', clearAllBtn: 'Clear All',
            totalItems: 'Total: {count}', expiresOn: 'Expires: {date}', removeBtn: 'Remove',
            noItems: 'Your list is empty!', confirmDeleteAll: 'Are you sure?',
            confirmDeleteAllTitle: 'Confirm Deletion', importPrompt: 'Paste your saved data here:',
            importTitle: 'Import Data', importSuccess: 'Data restored!', importError: 'Invalid data.',
            exportInfo: 'Copy this text and save it safely!', exportTitle: 'Export Data',
            okBtn: 'OK', cancelBtn: 'Cancel', searchPlaceholder: 'Search for items...',
            catGeneral: 'General', catVegetables: 'Vegetables', catFruits: 'Fruits',
            catDairy: 'Dairy', catMeats: 'Meats', catDrinks: 'Drinks'
        },
        'fr': {
            appName: 'Suivi Frigo', itemNamePlaceholder: 'Nom de l\'article', addBtn: 'Ajouter',
            exportBtn: 'Exporter', importBtn: 'Importer', clearAllBtn: 'Tout effacer',
            totalItems: 'Total : {count}', expiresOn: 'Expire le : {date}', removeBtn: 'Supprimer',
            noItems: 'Votre liste est vide !', confirmDeleteAll: '√ätes-vous s√ªr ?',
            confirmDeleteAllTitle: 'Confirmer la suppression', importPrompt: 'Collez vos donn√©es ici :',
            importTitle: 'Importer', importSuccess: 'Donn√©es restaur√©es !', importError: 'Donn√©es invalides.',
            exportInfo: 'Copiez ce texte et gardez-le !', exportTitle: 'Exporter',
            okBtn: 'OK', cancelBtn: 'Annuler', searchPlaceholder: 'Rechercher des articles...',
            catGeneral: 'G√©n√©ral', catVegetables: 'L√©gumes', catFruits: 'Fruits',
            catDairy: 'Produits laitiers', catMeats: 'Viandes', catDrinks: 'Boissons'
        },
        'ar': {
            appName: 'ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ´ŸÑÿßÿ¨ÿ©', itemNamePlaceholder: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨', addBtn: 'ÿ•ÿ∂ÿßŸÅÿ©',
            exportBtn: 'ÿ™ÿµÿØŸäÿ±', importBtn: 'ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ', clearAllBtn: 'ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ',
            totalItems: 'ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: {count}', expiresOn: 'ÿ™ŸÜÿ™ŸáŸä ŸÅŸä: {date}', removeBtn: 'ÿ≠ÿ∞ŸÅ',
            noItems: 'ŸÇÿßÿ¶ŸÖÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ©!', confirmDeleteAll: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ≠ÿ∞ŸÅÿü',
            confirmDeleteAllTitle: 'ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ', importPrompt: 'ÿßŸÑÿµŸÇ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸáŸÜÿß:',
            importTitle: 'ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', importSuccess: 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™!',
            importError: 'ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©.', exportInfo: 'ÿßŸÜÿ≥ÿÆ ÿßŸÑŸÜÿµ Ÿàÿßÿ≠ŸÅÿ∏Ÿá ŸÅŸä ŸÖŸÉÿßŸÜ ÿ¢ŸÖŸÜ!',
            exportTitle: 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', okBtn: 'ŸÖŸàÿßŸÅŸÇ', cancelBtn: 'ÿ•ŸÑÿ∫ÿßÿ°',
            searchPlaceholder: 'ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨...', catGeneral: 'ÿπÿßŸÖ', catVegetables: 'ÿÆÿ∂ÿ±Ÿàÿßÿ™',
            catFruits: 'ŸÅŸàÿßŸÉŸá', catDairy: 'ÿ£ŸÑÿ®ÿßŸÜ', catMeats: 'ŸÑÿ≠ŸàŸÖ', catDrinks: 'ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™'
        }
    };
    let currentLang = localStorage.getItem('language') || 'ar';
    const categoryIcons = { general: 'üì¶', vegetables: 'ü•ï', fruits: 'üçì', dairy: 'ü•õ', meats: 'ü•©', drinks: 'ü•§'};
    
    // --- Language Functions ---
    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('language', lang);
        const t = translations[lang];
        document.documentElement.lang = lang; document.documentElement.dir = t.dir || 'ltr';
        document.querySelectorAll('[data-lang-key]').forEach(el => {
            const key = el.dataset.langKey; if(t[key]) el.textContent = t[key];
        });
        document.querySelectorAll('[data-lang-placeholder-key]').forEach(el => {
            const key = el.dataset.langPlaceholderKey; if(t[key]) el.placeholder = t[key];
        });
        languageSwitcher.value = lang;
        renderItems();
    }
    function t(key, replacements = {}) {
        let text = translations[currentLang][key] || key;
        for (const placeholder in replacements) { text = text.replace(`{${placeholder}}`, replacements[placeholder]); }
        return text;
    }
    
    // --- UI & Rendering (NOW WITH CATEGORIES) ---
    function renderItems() {
        const searchTerm = searchBar.value.toLowerCase();
        const filteredItems = items.filter(item => item.name.toLowerCase().includes(searchTerm));
        
        itemList.innerHTML = '';
        if (items.length === 0) {
            noItemsMessage.style.display = 'block';
            countDisplay.textContent = t('totalItems', {count: 0});
            return;
        }
        noItemsMessage.style.display = 'none';
        countDisplay.textContent = t('totalItems', {count: filteredItems.length});

        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Group items by category
        const groupedItems = filteredItems.reduce((acc, item) => {
            const category = item.category || 'general';
            if (!acc[category]) {
                acc[category] = [];
            }
            acc[category].push(item);
            return acc;
        }, {});

        // Sort categories and render them
        Object.keys(groupedItems).sort().forEach(category => {
            const categoryContainer = document.createElement('div');
            categoryContainer.className = 'category-container';
            categoryContainer.innerHTML = `
                <div class="category-header">
                    <span class="category-icon">${categoryIcons[category] || 'üì¶'}</span>
                    <span class="category-title">${t('cat' + category.charAt(0).toUpperCase() + category.slice(1))}</span>
                </div>
            `;
            
            groupedItems[category].sort((a, b) => new Date(a.expiry) - new Date(b.expiry)).forEach(item => {
                const expiry = new Date(item.expiry);
                const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
                let status = 'green', icon = 'ü•¨';
                if (diffDays < 3 && diffDays >= 0) { status = 'orange'; icon = '‚ö†Ô∏è'; document.getElementById('alertSound').play(); }
                else if (diffDays < 0) { status = 'red'; icon = '‚õî'; }
                
                const originalIndex = items.findIndex(originalItem => originalItem === item);
                const div = document.createElement('div');
                div.className = `item ${status}`;
                div.innerHTML = `<span><span class="icon">${icon}</span>${item.name} ‚Äî ${t('expiresOn', {date: item.expiry})}</span> <button data-index="${originalIndex}">${t('removeBtn')}</button>`;
                categoryContainer.appendChild(div);
            });
            itemList.appendChild(categoryContainer);
        });
    }
    
    // --- Core Logic Functions ---
    function addItem(e) {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const expiry = document.getElementById('expiry').value;
      const category = document.getElementById('category').value; // Get category
      if (!name || !expiry) return;
      items.push({ name, expiry, category }); // Save category with item
      localStorage.setItem('fridgeItems', JSON.stringify(items));
      renderItems();
      form.reset();
    }
    itemList.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' && e.target.dataset.index) {
            const index = parseInt(e.target.dataset.index, 10);
            items.splice(index, 1);
            localStorage.setItem('fridgeItems', JSON.stringify(items));
            renderItems();
        }
    });
    function confirmClearAll() { showCustomConfirm(t('confirmDeleteAll'), t('confirmDeleteAllTitle'), (confirmed) => { if (confirmed) { items = []; localStorage.removeItem('fridgeItems'); renderItems(); } }); }
    function exportData(){if(items.length===0)return;const dataString=JSON.stringify(items,null,2);showCustomAlert(t('exportInfo'),t('exportTitle'),dataString);}
    function importData(){showCustomPrompt(t('importPrompt'),t('importTitle'),(dataString)=>{if(dataString){try{const importedItems=JSON.parse(dataString);if(Array.isArray(importedItems)){items=importedItems;localStorage.setItem('fridgeItems',JSON.stringify(items));renderItems();showCustomAlert(t('importSuccess'),t('appName'));}else{throw new Error('Not an array');}}catch(error){showCustomAlert(t('importError'),'Error');}}});}
    
    // --- Custom Modal Functions (Unchanged) ---
    const modal = document.getElementById('custom-modal'); const modalTitle = document.getElementById('modal-title'); const modalText = document.getElementById('modal-text'); const modalInputArea = document.getElementById('modal-input-area'); const confirmBtn = document.getElementById('modal-confirm-btn'); const cancelBtn = document.getElementById('modal-cancel-btn');
    function showCustomModal(title,text,type='alert',content='',callback=null){modalTitle.textContent=title;modalText.textContent=text;modalInputArea.innerHTML='';if(type==='prompt'||(type==='alert'&&content)){const inputEl=document.createElement('textarea');if(type==='prompt')inputEl.placeholder=t('importPrompt');else{inputEl.value=content;inputEl.readOnly=true;}modalInputArea.appendChild(inputEl);}confirmBtn.textContent=t('okBtn');cancelBtn.textContent=t('cancelBtn');cancelBtn.style.display=(type==='alert')?'none':'inline-block';modal.style.display='flex';confirmBtn.onclick=()=>{const inputValue=modalInputArea.querySelector('textarea')?.value;modal.style.display='none';if(callback)callback(inputValue||true);};cancelBtn.onclick=()=>{modal.style.display='none';if(callback)callback(false);};}
    function showCustomAlert(text, title, content = '') { showCustomModal(title, text, 'alert', content); } function showCustomConfirm(text, title, callback) { showCustomModal(title, text, 'confirm', '', callback); } function showCustomPrompt(text, title, callback) { showCustomModal(title, text, 'prompt', '', callback); }
    
    // --- Initialization ---
    function initialize() {
        Object.keys(translations).forEach(lang => { const option = document.createElement('option'); option.value = lang; option.textContent = lang.toUpperCase(); languageSwitcher.appendChild(option); });
        languageSwitcher.addEventListener('change', (e) => setLanguage(e.target.value));
        document.getElementById('themeToggle').addEventListener('click', () => { document.body.classList.toggle('light-mode'); localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark'); });
        if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        form.addEventListener('submit', addItem);
        searchBar.addEventListener('input', renderItems);
        setLanguage(currentLang);
    }
    initialize();
  </script>

</body>
</html>
